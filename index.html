<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Roguelike Chess Web</title>
<style>
  body { background: #222; color: white; font-family: sans-serif; text-align: center; }
  #board { display: grid; grid-template-columns: repeat(8, 60px); grid-template-rows: repeat(8, 60px); margin: 20px auto; }
  .square { width: 60px; height: 60px; display: flex; align-items: center; justify-content: center; font-size: 40px; }
  .light { background: #eee; }
  .dark { background: #555; }
  .selected { outline: 3px solid yellow; }
</style>
</head>
<body>
<h1>Roguelike Chess</h1>
<div id="board"></div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.13.4/chess.min.js"></script>
<script>
const boardDiv = document.getElementById('board');
const game = new Chess();
let selectedSquare = null;
let aiThinking = false;

function renderBoard() {
  boardDiv.innerHTML = '';
  const board = game.board();
  for (let r = 7; r >= 0; r--) {
    for (let c = 0; c < 8; c++) {
      const squareColor = (r + c) % 2 === 0 ? 'light' : 'dark';
      const squareDiv = document.createElement('div');
      squareDiv.className = `square ${squareColor}`;
      const piece = board[r][c];
      if (piece) {
        squareDiv.textContent = piece.type.toUpperCase() === 'P' ? (piece.color === 'w' ? '♙' : '♟') :
                                 piece.type === 'r' ? (piece.color === 'w' ? '♖' : '♜') :
                                 piece.type === 'n' ? (piece.color === 'w' ? '♘' : '♞') :
                                 piece.type === 'b' ? (piece.color === 'w' ? '♗' : '♝') :
                                 piece.type === 'q' ? (piece.color === 'w' ? '♕' : '♛') :
                                 piece.color === 'w' ? '♔' : '♚';
      }
      const file = 'abcdefgh'[c];
      const rank = (r+1).toString();
      const squareName = file + rank;
      squareDiv.addEventListener('click', () => onSquareClick(squareName));
      if (selectedSquare === squareName) squareDiv.classList.add('selected');
      boardDiv.appendChild(squareDiv);
    }
  }
}

function onSquareClick(square) {
  if (aiThinking) return;
  if (!selectedSquare) {
    const moves = game.moves({ square, verbose: true });
    if (moves.length > 0) {
      selectedSquare = square;
      renderBoard();
    }
  } else {
    const move = game.move({ from: selectedSquare, to: square });
    selectedSquare = null;
    renderBoard();
    if (move) {
      aiMove();
    }
  }
}

function aiMove() {
  aiThinking = true;
  setTimeout(() => {
    const moves = game.moves();
    if (moves.length > 0) {
      const move = moves[Math.floor(Math.random() * moves.length)];
      game.move(move);
    }
    aiThinking = false;
    renderBoard();
  }, 500);
}

renderBoard();
</script>
</body>
</html>
