<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Roguelike Chess Web</title>
<style>
  body { background: #222; color: white; font-family: sans-serif; text-align: center; }
  #board { display: grid; grid-template-columns: repeat(8, 60px); grid-template-rows: repeat(8, 60px); margin: 20px auto; }
  .square { width: 60px; height: 60px; display: flex; align-items: center; justify-content: center; font-size: 40px; }
  .light { background: #eee; color: black; }
  .dark { background: #555; color: white; }
  .selected { outline: 3px solid yellow; }
</style>
</head>
<body>
<h1>Roguelike Chess</h1>
<div id="board"></div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.13.4/chess.min.js"></script>
<script>
const boardDiv = document.getElementById('board');
let game;
try {
  game = new Chess();
} catch(e) {
  console.error("Chess.js failed to load", e);
}
let selectedSquare = null;
let aiThinking = false;

function renderBoard() {
  if (!game) return;
  boardDiv.innerHTML = '';
  const board = game.board();
  for (let r = 7; r >= 0; r--) {
    for (let c = 0; c < 8; c++) {
      const squareColor = (r + c) % 2 === 0 ? 'light' : 'dark';
      const squareDiv = document.createElement('div');
      squareDiv.className = `square ${squareColor}`;
      const piece = board[r][c];
      if (piece) {
        const symbolMap = {
          'p': piece.color === 'w' ? '♙' : '♟',
          'r': piece.color === 'w' ? '♖' : '♜',
          'n': piece.color === 'w' ? '♘' : '♞',
          'b': piece.color === 'w' ? '♗' : '♝',
          'q': piece.color === 'w' ? '♕' : '♛',
          'k': piece.color === 'w' ? '♔' : '♚'
        };
        squareDiv.textContent = symbolMap[piece.type] || '';
      }
      const file = 'abcdefgh'[c];
      const rank = (r + 1).toString();
      const squareName = file + rank;
      squareDiv.addEventListener('click', () => onSquareClick(squareName));
      if (selectedSquare === squareName) squareDiv.classList.add('selected');
      boardDiv.appendChild(squareDiv);
    }
  }
}

function onSquareClick(square) {
  if (aiThinking || !game) return;
  if (!selectedSquare) {
    const moves = game.moves({ square, verbose: true });
    if (moves.length > 0) {
      selectedSquare = square;
      renderBoard();
    }
  } else {
    const move = game.move({ from: selectedSquare, to: square, promotion: 'q' });
    selectedSquare = null;
    renderBoard();
    if (move) aiMove();
  }
}

function aiMove() {
  aiThinking = true;
  setTimeout(() => {
    const moves = game.moves();
    if (moves.length > 0) {
      const move = moves[Math.floor(Math.random() * moves.length)];
      game.move(move, { promotion: 'q' });
    }
    aiThinking = false;
    renderBoard();
  }, 200);
}

renderBoard();
</script>
</body>
</html>
